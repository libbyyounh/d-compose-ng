events {
    worker_connections 1024;
}

http {
    # HTTP 服务: 监听 80 端口
    server {
        listen 80;
        listen [::]:80;
        server_name _; # 匹配所有主机名

        # 直接返回默认的文本信息
        location / {
            return 200 'Nginx is running on port 80.\n';
            add_header Content-Type text/plain;
        }
    }

    # HTTPS 服务: 监听 443 端口，并进行反向代理
    server {
        listen 443 ssl;
        listen [::]:443 ssl;
        server_name _; # 匹配所有主机名

        # 配置 SSL 证书路径
        # 这些路径是容器内部的路径，我们会在 docker-compose.yml 中进行映射
        ssl_certificate /etc/nginx/ssl/nginx.crt;
        ssl_certificate_key /etc/nginx/ssl/nginx.key;

        # 优化 SSL 安全性 (可选，但推荐)
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers 'TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:ECDHE-RSA-AES128-GCM-SHA256';

        location / {
            # 关键部分：将请求转发到您的应用
            proxy_pass http://dy-express-api:3000;

            # 设置一些必要的代理头信息
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }
}